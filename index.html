<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Editor de PDF Professional</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }
        header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        /* TABS */
        .tabs { display: flex; background: #f5f5f5; border-bottom: 2px solid #ddd; overflow-x: auto; }
        .tab {
            flex: 1; padding: 18px; display: flex; align-items: center; justify-content: center;
            gap: 10px; cursor: pointer; border: none; font-weight: 600; color: #555; transition: 0.3s;
            min-width: 150px;
        }
        .tab.active { background: white; color: #667eea; border-bottom: 3px solid #667eea; }
        .tab-content { display: none; padding: 40px; }
        .tab-content.active { display: block; }

        /* UPLOAD AREAS */
        .upload-area {
            border: 3px dashed #667eea;
            border-radius: 15px;
            padding: 40px;
            text-align: center;
            cursor: pointer;
            background: #f8f9ff;
            transition: 0.3s;
        }
        .upload-area:hover { background: #e8ebff; border-color: #764ba2; }
        .upload-icon svg { width: 50px; height: 50px; color: #667eea; margin-bottom: 10px; }

        /* GRID DE P츼GINAS (EL EDITOR VISUAL) */
        .pdf-preview-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }
        .page-item {
            position: relative;
            background: #fff;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            padding: 10px;
            cursor: grab;
            transition: 0.2s;
        }
        .page-item:hover { transform: translateY(-5px); border-color: #667eea; box-shadow: 0 10px 15px rgba(0,0,0,0.1); }
        .page-item canvas { width: 100%; border-radius: 8px; border: 1px solid #eee; }
        .page-info { font-size: 11px; text-align: center; margin-top: 8px; color: #64748b; font-weight: 600; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        
        .delete-page {
            position: absolute;
            top: -10px;
            right: -10px;
            background: #ff4757;
            color: white;
            border: none;
            width: 26px;
            height: 26px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            z-index: 10;
        }

        /* CONTROLES Y BOTONES */
        .controls { text-align: center; margin-top: 30px; padding-top: 20px; border-top: 1px solid #eee; }
        .btn {
            display: inline-flex; align-items: center; gap: 8px;
            padding: 12px 24px; border-radius: 50px; border: none;
            font-weight: 600; cursor: pointer; transition: 0.3s;
            color: white; background: #667eea; margin: 5px;
        }
        .btn-danger { background: #ff4757; }
        .btn:hover { opacity: 0.9; transform: translateY(-2px); }

        /* PREVIEW IMAGENES */
        .image-preview-container { display: flex; flex-wrap: wrap; gap: 15px; margin-top: 20px; justify-content: center; }
        .image-preview-container img { max-width: 150px; border-radius: 10px; border: 1px solid #ddd; }

        .progress-bar {
            width: 100%; height: 12px; background: #eee; border-radius: 10px;
            margin: 20px 0; display: none; overflow: hidden;
        }
        .progress-fill { height: 100%; background: #667eea; width: 0%; transition: 0.3s; text-align: center; color: white; font-size: 10px; line-height: 12px; }
        
        input[type="file"] { display: none; }
        .quality-selector { margin: 15px 0; display: flex; justify-content: center; gap: 15px; align-items: center; }
        select { padding: 8px; border-radius: 8px; border: 1px solid #ddd; }
    </style>
</head>
<body>

<div class="container">
    <header>
        <h1>游늯 Editor de PDF Professional</h1>
        <p>Edita, une y convierte tus documentos con total privacidad</p>
    </header>

    <div class="tabs">
        <button class="tab active" onclick="switchTab(0)">
            <svg style="width:20px" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4"></path></svg>
            Unir y Editar
        </button>
        <button class="tab" onclick="switchTab(1)">
            <svg style="width:20px" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path></svg>
            Editar Existente
        </button>
        <button class="tab" onclick="switchTab(2)">
            <svg style="width:20px" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path></svg>
            PDF a Imagen
        </button>
        <button class="tab" onclick="switchTab(3)">
            <svg style="width:20px" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 13h6m-3-3v6m5 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path></svg>
            Imagen a PDF
        </button>
    </div>

    <div class="tab-content active" id="tab-0">
        <div class="upload-area" onclick="document.getElementById('merge-input').click()">
            <div class="upload-icon">
                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 13h6m-3-3v6m-9 1V7a2 2 0 012-2h6l2 2h6a2 2 0 012 2v8a2 2 0 01-2 2H5a2 2 0 01-2-2z"></path></svg>
            </div>
            <h2>Sube PDFs para combinar y editar</h2>
            <p>Arrastra las p치ginas para ordenarlas o b칩rralas.</p>
            <input type="file" id="merge-input" multiple accept=".pdf" onchange="processMergeFiles(this.files)">
        </div>
        <div id="merge-pages-grid" class="pdf-preview-grid"></div>
        <div class="controls" id="merge-controls" style="display:none;">
            <div class="progress-bar" id="merge-progress-bar"><div class="progress-fill" id="merge-progress-fill"></div></div>
            <button class="btn" onclick="generateMergedPDF()">
                <svg style="width:18px" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"></path></svg>
                Unir y Descargar
            </button>
            <button class="btn btn-danger" onclick="clearMerge()">Limpiar todo</button>
        </div>
    </div>

    <div class="tab-content" id="tab-1">
        <div class="upload-area" onclick="document.getElementById('edit-single-input').click()">
            <div class="upload-icon">
                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"></path></svg>
            </div>
            <h2>Selecciona un PDF para editar</h2>
            <input type="file" id="edit-single-input" accept=".pdf" onchange="processMergeFiles(this.files)">
        </div>
    </div>

    <div class="tab-content" id="tab-2">
        <div class="upload-area" onclick="document.getElementById('pdf-to-img-input').click()">
            <div class="upload-icon">
                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path></svg>
            </div>
            <h2>Convertir PDF a Im치genes</h2>
            <input type="file" id="pdf-to-img-input" accept=".pdf" onchange="convertPdfToImages(this.files[0])">
        </div>
        <div class="quality-selector">
            <label>Calidad:</label>
            <select id="img-quality"><option value="1">Baja</option><option value="2" selected>Media</option><option value="3">Alta</option></select>
        </div>
        <div id="image-results" class="image-preview-container"></div>
    </div>

    <div class="tab-content" id="tab-3">
        <div class="upload-area" onclick="document.getElementById('img-to-pdf-input').click()">
            <div class="upload-icon">
                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 5a1 1 0 011-1h14a1 1 0 011 1v2a1 1 0 01-1 1H5a1 1 0 01-1-1V5zM4 13a1 1 0 011-1h6a1 1 0 011 1v6a1 1 0 01-1 1H5a1 1 0 01-1-1v-6zM16 13a1 1 0 011-1h2a1 1 0 011 1v6a1 1 0 01-1 1h-2a1 1 0 01-1-1v-6z"></path></svg>
            </div>
            <h2>Convertir Im치genes a PDF</h2>
            <input type="file" id="img-to-pdf-input" multiple accept="image/*" onchange="processImagesToPdf(this.files)">
        </div>
        <div id="img-to-pdf-preview" class="image-preview-container"></div>
        <div class="controls" id="img-to-pdf-controls" style="display:none;">
            <button class="btn" onclick="generatePdfFromImages()">Generar PDF</button>
            <button class="btn btn-danger" onclick="clearImgToPdf()">Limpiar</button>
        </div>
    </div>
</div>

<script>
    pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';
    
    let allPages = []; 
    let selectedImages = [];

    function switchTab(idx) {
        document.querySelectorAll('.tab').forEach((t, i) => t.classList.toggle('active', i === idx));
        document.querySelectorAll('.tab-content').forEach((c, i) => c.classList.toggle('active', i === idx));
    }

    // --- L칍GICA M칍DULO 1 Y 2 (UNIR Y EDITAR) ---
    async function processMergeFiles(files) {
        const controls = document.getElementById('merge-controls');
        for (const file of files) {
            const arrayBuffer = await file.arrayBuffer();
            const pdf = await pdfjsLib.getDocument(arrayBuffer).promise;
            for (let i = 1; i <= pdf.numPages; i++) {
                const page = await pdf.getPage(i);
                const viewport = page.getViewport({ scale: 0.5 });
                const canvas = document.createElement('canvas');
                canvas.width = viewport.width; canvas.height = viewport.height;
                await page.render({ canvasContext: canvas.getContext('2d'), viewport }).promise;
                allPages.push({ canvas, fileName: file.name, pageNum: i });
            }
        }
        renderPages();
        controls.style.display = 'block';
        switchTab(0); // Forzar vista al editor visual
    }

    function renderPages() {
        const grid = document.getElementById('merge-pages-grid');
        grid.innerHTML = '';
        allPages.forEach((pageObj, index) => {
            const div = document.createElement('div');
            div.className = 'page-item';
            div.draggable = true;
            div.innerHTML = `
                <button class="delete-page" onclick="removePage(${index})">
                    <svg style="width:12px" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-width="3" d="M6 18L18 6M6 6l12 12"></path></svg>
                </button>
                <div class="canvas-container"></div>
                <div class="page-info">${pageObj.fileName} (P치g. ${pageObj.pageNum})</div>
            `;
            const thumb = document.createElement('canvas');
            thumb.width = pageObj.canvas.width; thumb.height = pageObj.canvas.height;
            thumb.getContext('2d').drawImage(pageObj.canvas, 0, 0);
            div.querySelector('.canvas-container').appendChild(thumb);

            div.addEventListener('dragstart', (e) => { e.dataTransfer.setData('text', index); div.style.opacity = '0.5'; });
            div.addEventListener('dragend', () => div.style.opacity = '1');
            div.addEventListener('dragover', (e) => e.preventDefault());
            div.addEventListener('drop', (e) => {
                e.preventDefault();
                const fromIdx = e.dataTransfer.getData('text');
                const element = allPages.splice(fromIdx, 1)[0];
                allPages.splice(index, 0, element);
                renderPages();
            });
            grid.appendChild(div);
        });
    }

    function removePage(index) { allPages.splice(index, 1); renderPages(); }
    function clearMerge() { allPages = []; renderPages(); document.getElementById('merge-controls').style.display = 'none'; }

    async function generateMergedPDF() {
        const { jsPDF } = window.jspdf;
        const pdf = new jsPDF();
        for (let i = 0; i < allPages.length; i++) {
            if (i > 0) pdf.addPage();
            const imgData = allPages[i].canvas.toDataURL('image/jpeg', 0.9);
            pdf.addImage(imgData, 'JPEG', 0, 0, pdf.internal.pageSize.getWidth(), pdf.internal.pageSize.getHeight());
        }
        pdf.save('Documento_Editado.pdf');
    }

    // --- L칍GICA M칍DULO 3 (PDF A IMAGEN) ---
    async function convertPdfToImages(file) {
        if (!file) return;
        const results = document.getElementById('image-results');
        results.innerHTML = '<p>Procesando...</p>';
        const arrayBuffer = await file.arrayBuffer();
        const pdf = await pdfjsLib.getDocument(arrayBuffer).promise;
        const quality = document.getElementById('img-quality').value;
        results.innerHTML = '';

        for (let i = 1; i <= pdf.numPages; i++) {
            const page = await pdf.getPage(i);
            const viewport = page.getViewport({ scale: quality });
            const canvas = document.createElement('canvas');
            canvas.width = viewport.width; canvas.height = viewport.height;
            await page.render({ canvasContext: canvas.getContext('2d'), viewport }).promise;
            
            const img = document.createElement('img');
            img.src = canvas.toDataURL('image/png');
            const link = document.createElement('a');
            link.href = img.src; link.download = `pagina_${i}.png`;
            link.appendChild(img);
            results.appendChild(link);
        }
    }

    // --- L칍GICA M칍DULO 4 (IMAGEN A PDF) ---
    function processImagesToPdf(files) {
        selectedImages = Array.from(files);
        const preview = document.getElementById('img-to-pdf-preview');
        preview.innerHTML = '';
        selectedImages.forEach(file => {
            const img = document.createElement('img');
            img.src = URL.createObjectURL(file);
            preview.appendChild(img);
        });
        document.getElementById('img-to-pdf-controls').style.display = 'block';
    }

    async function generatePdfFromImages() {
        const { jsPDF } = window.jspdf;
        const pdf = new jsPDF();
        for (let i = 0; i < selectedImages.length; i++) {
            if (i > 0) pdf.addPage();
            const img = new Image();
            img.src = URL.createObjectURL(selectedImages[i]);
            await new Promise(r => img.onload = r);
            pdf.addImage(img, 'JPEG', 0, 0, pdf.internal.pageSize.getWidth(), pdf.internal.pageSize.getHeight());
        }
        pdf.save('Imagenes_a_PDF.pdf');
    }

    function clearImgToPdf() {
        selectedImages = [];
        document.getElementById('img-to-pdf-preview').innerHTML = '';
        document.getElementById('img-to-pdf-controls').style.display = 'none';
    }
</script>

</body>
</html>
